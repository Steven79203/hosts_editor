#!/bin/bash 

#Edithosts

export HOSTS=/etc/dothosts
export TMP=/tmp/pattern.tmp
export DIR=~/Custom-Scripts/hosts_diff

comment(){

	echo -n "PADRÃO: "; read PATT
	grep $PATT $HOSTS > $TMP

	DIFF=$DIR/dothosts_$PATT.diff
	sed "/^[^\#] *[a-zA-Z0-9\.\ ]*$PATT/ s/./#&/" $HOSTS > $TMP && diff -u $HOSTS $TMP > $DIFF
	bat $DIFF
	echo "Aplicar modificações? [S/N]: "; read CONF;

	if [[ $CONF == 's' || $CONF == 'S' ]]; then
		sudo patch $HOSTS $DIFF 
	else
		rm $DIFF
		echo "Nada foi modificado"
	fi
	rm $TMP
}

uncomment(){
	DIFF=$( ls $DIR | grep "diff$" | dmenu -l 10 -p "Qual patch reverter?")
	RDIFF=$DIR/$DIFF
	echo -n "Continuar? [S/N]: "; read CONF
	[[ $CONF == 's' || $CONF == 'S' ]] && sudo patch -R $HOSTS "$RDIFF" && rm $RDIFF
}

OP=$(echo -e "Desbloquear\nBloquear" | dmenu -p "Operação")

case $OP in
	Desbloquear) comment ;;
	Bloquear) uncomment ;;
esac
